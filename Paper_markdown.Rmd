---
title: "Paper_text_working_file"
author: "Addison"
date: "April 5, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
#Packages 

install.packages("tidyverse")
install.packages("DataCombine")
install.packages("dotwhisker")

library(plyr)
library(tidyverse)
library(DataCombine)
library(haven)
library(dotwhisker)

options(digits = 4)

#Data generation process 

dyadic_mid_3_1_may_2018 <-as_tibble( read_dta("C:/Users/packe/Documents/Methods_3/Paper/Datasets/dyadic_mid_3.1_may_2018.dta"))
View(dyadic_mid_3_1_may_2018)

#Renaming variables in MIDs data
Dyadic_MID <- dyadic_mid_3_1_may_2018 %>%
  rename(
    ccodea = statea,
    ccodeb = stateb
  ) 
Dyadic_MID


#Relative capabilities data
NMC_5_0 <- as_tibble(read_dta("C:/Users/packe/Documents/Methods_3/Paper/Datasets/NMC_5_0.dta"))
View(NMC_5_0)
NMC <- select(NMC_5_0, ccode, year, irst, milex, milper, pec, tpop, upop, cinc)
NMCA <- NMC %>%
  rename(
    ccodea = ccode,
    irsta = irst,
    milexa = milex,
    milpera = milper,
    peca = pec,
    tpopa = tpop,
    upopa = upop,
    cinca = cinc
  ) 
NMCA
  
NMCB <- NMC %>%
  rename(
    ccodeb = ccode,
    irstb = irst,
    milexb = milex,
    milperb = milper,
    pecb = pec,
    tpopb = tpop,
    upopb = upop,
    cincb = cinc
  ) 
NMCB

#Importing naval data, removing all but the data for the U.S., keeping only relevant variables.
crisher_souva_navaldata_II <- as_tibble(read_dta("C:/Users/packe/Documents/Methods_3/Paper/Datasets/crisher_souva_navaldata_II.dta"))
View(crisher_souva_navaldata_II)
Naval1 <- filter(crisher_souva_navaldata_II, cowcode == 2)
Naval2 <- select(Naval1, year, totton, tonn_prop, milex, milper)

#Importing PolityIV data and creating two seperate datasets to apply to both members of the dyad.
PolityIV <- as_tibble(read_dta("C:/Users/packe/Documents/Methods_3/Paper/Datasets/PolityIV.dta"))
view(PolityIV)

PolityIV1 <- select(PolityIV, year, ccode, democ, autoc, polity, polity2)
PolityIVa <- PolityIV1 %>%
  rename(
    ccodea = ccode,
    democa = democ,
    autoca = autoc,
    politya = polity,
    polity2a = polity2
  ) 
view(PolityIVa)

PolityIVb <- PolityIV1 %>%
  rename(
    ccodeb = ccode,
    democb = democ,
    autocb = autoc,
    polityb = polity,
    polity2b = polity2
  ) 
PolityIVb

Atop <- as_tibble(read_dta("C:/Users/packe/Documents/Methods_3/Paper/Datasets/Atop_stata.dta"))
view(Atop)

politically_relevant <- as_tibble(read_dta("C:/Users/packe/Documents/Methods_3/Paper/Datasets/politically_relevant.dta"))
view(politically_relevant)

Master <- politically_relevant %>%
  rename(
    ccodea = ccode1,
    ccodeb = ccode2, 
  ) 
Master

#mergin in dyadic mid data
Master2 <- full_join(Master, Dyadic_MID, by=c("ccodea", "ccodeb", "year"), copy=FALSE, suffix=c("x", "y"))
summary(Master2$year)

#Merging in polity iv datasets a and b.
Master2 <- inner_join(Master2, PolityIVa, by=c("ccodea", "year"), copy=FALSE, suffix=c("x", "y"))
Master2 <- inner_join(Master2, PolityIVb, by=c("ccodeb", "year"), copy=FALSE, suffix=c("x", "y"))

#merging in data on US naval capabilities
Master2 <- inner_join(Master2, Naval2, by=c("year"), copy=FALSE, suffix=c("x", "y"))

#merging in data on material capabilities
Master2 <- inner_join(Master2, NMCA, by=c("ccodea", "year"), copy=FALSE, suffix=c("x", "y"))
Master2 <- inner_join(Master2, NMCB, by=c("ccodeb", "year"), copy=FALSE, suffix=c("x", "y"))

Master2 <- full_join(Master2, Atop, by=c("ccodea", "ccodeb", "year"), copy=FALSE, suffix=c("x", "y"))

Master3 <- filter(Master2, ccodea != 2, ccodeb != 2, year < 2012, year >= 1950)






#Variable Generation

#Creating a variable which only identifies if a mid occured in that dyad-year
head(Master3$hihost, 1000)
Master3 <- Master3 %>%
    mutate(Mid = ifelse(is.na(hihost), 0, 1))
head(Master3$Mid, 1000)

#Creating a variable which only identifies if a Mid which involved the use of force occured in that dyad-year.
head(Master3$hihost, 1000)
Master3 <- Master3 %>%
    mutate(Use_Force = ifelse(hihost > 3, 1, 0))
Master3$Use_Force[is.na(Master3$Use_Force)] <- 0
head(Master3$Use_Force, 1000)

#Creating variable identifying joint democracy
Master3 <- Master3 %>%
    mutate(Joint_Dem = ifelse(polity2a >= 6 & polity2b >=6, 1, 0))
head(Master3$Joint_Dem, 1000)

#Creating variable identifying if at least one member of the dyad is a major power.
Master3 <- Master3 %>%
    mutate(Major = ifelse(majpow1 == 1 | majpow2 == 1, 1, 0))
head(Master3$Major, 1000)

#Creating a variable identifying if the dyad had experienced a MID in the previous two years.
Master3 <- slide(Master3, Var = "Mid", GroupVar = "" slideBy = -2)

#Variable identfying the presence of an alliance between the two members of the dyad
Master3 <- Master3 %>%
    mutate(Ally = ifelse(atopally ==1, 1, 0))
Master3$Ally[is.na(Master3$Ally)] <- 0
head(Master3$Ally, 1000)

#Variable identifying if the two members of the dyad are in the same region
Master3 <- Master3 %>%
    mutate(Same_Region = ifelse(region1 == region2, 1, 0))
head(Master3$Same_Region, 1000)

#Creating a naval capability variable by modifying the systemic proportion of naval tonnage held by the US
Master3 <- Master3 %>%
    mutate(US_Naval_Cap =(milex/milper)*tonn_prop) 
Master3 <- Master3 %>%
    mutate(US_Naval_Cap = (US_Naval_Cap/10000)) 
head(Master3$US_Naval_Cap, 1000)

#Binary variable identifying if the dyad year is during or after the Cold War
Master3 <- Master3 %>%
    mutate(Post_Cold_War = ifelse(year > 1990, 1, 0)) 

#Creating variable measuring relative capabilities
Master3 <- filter(Master3, cinca != -9, cincb != -9)
Master3 <- Master3 %>%
    mutate(Relative_Cap = cinca/(cinca+cincb))
head(Master3$Relative_Cap, 1000)

Master3 <- Master3 %>%
    mutate(Hostility = 0) %>%
    Hostility[hihost == 2] <- 1 %>%
    Hostility[hihost == 3] <- 2 %>%
    Hostility[hihost == 4] <- 3 %>%
    Hostility[hihost == 5] <- 4 %>%
    Hostility[ifelse(is.na(hihost))] <- 0

Master3 <- Master3 %>%
  rename(
    Contiguous = contig,
  ) 

Master4 <- select(Master3, year, Mid, Use_Force, US_Naval_Cap, Same_Region, Contiguous, Ally, Joint_Dem, Relative_Cap, Major, Post_Cold_War)
summary(Master4)







#Statistical Tests

#Bivariate Logits
MID_BI_Log <- glm(Mid ~ US_Naval_Cap, data = Master4, family=binomial)
summary(MID_BI_Log)
dwplot(MID_BI_Log)

Force_BI_Log <- glm(Use_Force ~ US_Naval_Cap, data = Master4, family=binomial)
summary(Force_BI_Log)
dwplot(Force_BI_Log)


#Full Models
  #Logistic regression
MID_Full_Log <- glm(Mid ~ US_Naval_Cap + Same_Region + Contiguous + Ally + Joint_Dem + Relative_Cap + Major + Post_Cold_War, data = Master4)
summary(MID_Full_Log)
dwplot(MID_Full_Log)

Force_Full_Log <- glm(Use_Force ~ US_Naval_Cap + Same_Region + Contiguous + Ally + Joint_Dem + Relative_Cap, data = Master4)
summary(Force_Full_Log)
dwplot(Force_Full_Log)

  #Mlogit model
Hostility_Mlog <- mlogit(Hostility ~ US_Naval_Cap + Same_Region + Contiguous + Ally + Joint_Dem + Relative_Cap, data = Master4, reflevel = 0)
summary(Hostility_Mlog)
dwplot(Hostility_Mlog)

  #Heckman model 